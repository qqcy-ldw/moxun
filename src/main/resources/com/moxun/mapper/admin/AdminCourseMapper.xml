<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.moxun.mapper.admin.AdminCourseMapper">

    <resultMap id="courseMap" type="com.moxun.Pojo.Entity.Course">
        <!-- 课程基本属性 -->
        <id property="id" column="id" />
        <result property="title" column="title" />
        <result property="description" column="description" />
        <result property="coverImage" column="cover_image" />
        <result property="price" column="price" />
        <result property="categoryId" column="category_id" />
        <result property="level" column="level" />
        <result property="duration" column="duration" />
        <result property="teacherId" column="teacher_id" />
        <result property="status" column="status" />
        <result property="studentCount" column="student_count" />
        <result property="createTime" column="create_time" />
        <result property="updateTime" column="update_time" />

        <!-- 章节集合，元素类型为 ChapterVO -->
        <collection property="chapters" ofType="com.moxun.Pojo.Vo.ChapterVO">
            <id property="id" column="chapter_id" />
            <result property="title" column="chapter_title" />
            <result property="sort" column="chapter_sort" />
            <result property="createTime" column="chapter_create_time" />

            <!-- 课时集合，元素类型为 SectionVO -->
            <collection property="sections" ofType="com.moxun.Pojo.Vo.SectionVO">
                <id property="id" column="section_id" />
                <result property="title" column="section_title" />
                <result property="videoUrl" column="section_video_url" />
                <result property="duration" column="section_duration" />
                <result property="isFree" column="section_is_free" />
                <result property="sort" column="section_sort" />
                <result property="createTime" column="section_create_time" />
            </collection>
        </collection>
    </resultMap>

    <select id="listCourses" resultType="com.moxun.Pojo.Entity.Course">
        select *
        from courses
        <where>
            <if test="title != null and title != ''">
                title like concat('%',#{title},'%')
            </if>
            <if test="categoryId != null">
                and category_id = #{categoryId}
            </if>
            <if test="status != null">
                and status = #{status}
            </if>
        </where>
    </select>
    <select id="getCourseById" resultType="com.moxun.Pojo.Vo.CourseDetailVO">
        SELECT
            c.id, c.title, c.description, c.cover_image, c.price, c.category_id, c.level,
            c.duration, c.teacher_id, c.status, c.student_count, c.create_time, c.update_time,
            ch.id AS chapter_id,
            ch.title AS chapter_title,
            ch.sort AS chapter_sort,
            ch.create_time AS chapter_create_time,
            s.id AS section_id,
            s.title AS section_title,
            s.video_url AS section_video_url,
            s.duration AS section_duration,
            s.is_free AS section_is_free,
            s.sort AS section_sort,
            s.create_time AS section_create_time
        FROM courses c
                 LEFT JOIN chapters ch ON c.id = ch.course_id
                 LEFT JOIN sections s ON ch.id = s.chapter_id
        WHERE c.id = #{id}
        ORDER BY ch.sort, s.sort
    </select>
</mapper>